define(["jquery","underscore","qlik","client.utils/state","./lib/external/d3/d3.v4.min","./properties","./initialproperties","./lib/external/sense-extension-utils/general-utils","general.utils/responsive-state","objects.utils/num-date-time-formatter","general.utils/number-formatting","text!./lib/partials/template.html","text!./lib/partials/tooltip-template.html","text!./lib/css/style.css","text!./lib/css/climber-icons.css","text!themes/old/sense/theme.json"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";return h.addStyleToHeader(n),h.addStyleToHeader(o),{definition:f,initialProperties:g,snapshot:{canTakeSnapshot:!0},resize:function(a,b){this.paint(a,b)},template:l,thinHeader:!0,controller:["$scope",function(f){f.infinityReplacementChar="-";var g=c.currApp();f.localeInfo=g.model.layout.qLocaleInfo,f.DEFAULT_AUTO_FORMAT="0A",f.initNumberFormatter=function(){f.numberFormatter=new j(f.localeInfo,f.DEFAULT_AUTO_FORMAT,f.localeInfo.qThousandSep,f.localeInfo.qDecimalSep,"U"),f.DEFAULT_AUTO_FORMAT=f.numberFormatter.createPatternFromRange(0,1,!0)},f.isSmallDevice=i.isSmallDevice,f.showOverlay=!1,f.scales={},f.theme=JSON.parse(p),f.color={background:f.theme.backgroundColor,defaultBlendFactor:.3},f.showIcon=function(){var a=!f.options.showIconWithTitle&&!f.options.hideIcon;return a},f.showIconWithTitle=function(){var a=f.options.showIconWithTitle&&!f.options.hideIcon;return a},f.getSentimentFromValues=function(a){var b=a.value01-a.value02,c="3-colors"===a.colorMode?a.banding/100*a.value02:0,d=b>=0?1:-1;return"less_is_better"===a.comparisonType&&(d=-d),0!==c&&("more_is_better"===a.comparisonType&&-b>=0&&c>-b?d=0:"less_is_better"===a.comparisonType&&b>=0&&c>b&&(d=0)),d},f.getColor=function(a,b,c){var d=1;if("argb("===a.substring(0,5).toLowerCase()){var g=a.substr(5,a.length-6).split(",");4===g.length?(d=g[0]/255,a="rgba("+g[1]+","+g[2]+","+g[3]+","+d+")"):a=void 0}if(b&&void 0===c)return e.color(e.interpolateRgb(f.color.background,e.rgb(a))(f.color.defaultBlendFactor*d)).toString();if(b&&void 0!==c)return e.color(e.interpolateRgb(f.color.background,e.rgb(a))(c*d)).toString();if(c>=0&&!b){var h=e.rgb(a);return h.opacity=c*d,h.toString()}return e.color(a).toString()},f.options={},f.gotoSheet=function(){!b.isEmpty(f.options.sheetId)&&d.isInAnalysisMode()&&(f.doActionBeforeNavigation(),c.navigation.gotoSheet(f.options.sheetId))},f.setVariable=function(a,d){if(!b.isEmpty(a)&&!b.isEmpty(d)){var e=c.currApp();e.variable.setContent(a,d)}},f.selectValueInField=function(a,d){if(!b.isEmpty(a)&&!b.isEmpty(d)){var e=c.currApp();e.field(a).selectMatch(d,!1)}},f.splitToStringNum=function(a,b){for(var c=a.split(b),d=0;d<c.length;d++)isNaN(c[d])||(c[d]=Number(c[d]));return c},f.selectValuesInField=function(a,d){if(!b.isEmpty(a)&&!b.isEmpty(d)){var e=c.currApp(),g=f.splitToStringNum(d,",");e.field(a).selectValues(g,!1)["catch"](function(a){})}},f.clearSelectionsInField=function(a){if(!b.isEmpty(a)){var d=c.currApp();d.field(a).clear()["catch"](function(a){})}},f.doActionBeforeNavigation=function(){switch(f.options.navigation.actionBeforeNavigation){case"clearSelectionsInField":f.clearSelectionsInField(f.options.navigation.field);break;case"selectValueInField":f.selectValueInField(f.options.navigation.field,f.options.navigation.value);break;case"selectValuesInField":f.selectValuesInField(f.options.navigation.field,f.options.navigation.values);break;case"setVariable":f.setVariable(f.options.navigation.variable,f.options.navigation.variableValue)}},f.formatValue=function(a,b){return a?(f.numberFormatter.pattern=b,f.numberFormatter.format(+a).replace("Infinity",f.infinityReplacementChar)):""},f.mouseover=function(){(f.options.navigation.mode||f.options.showDetails)&&(f.showOverlay=!0)},f.mouseout=function(){(f.options.navigation.mode||f.options.showDetails)&&(f.showOverlay=!1)},f.updateTooltip=function(b,c,d,e){var g,h=b.x-f.options.margins.left;g=h<=d.range()[0]?0:h>=d.range()[1]?d.domain().length-1:Math.round(h/(d.range()[1]-d.range()[0])*(d.domain().length-1));var i=f.options.transformedData[0].values[g],j=2===f.options.transformedData.length,k=j?f.options.transformedData[1].values[g]:{},l="",n="rgb(255,255,255)";if(f.options.inTargetMode&&!f.options.targetColorModeIsExpression){f.options.comparisionIsRelative?(l=f.formatValue(i.y.value/k.y.value-1,f.options.formats.comparison),""===l&&(l="0%")):l=f.formatValue(i.y.value-k.y.value,f.options.formats.comparison);var o={value01:i.y.value,value02:k.y.value,comparisonType:f.options.comparison.type,banding:f.options.comparison.banding,colorMode:f.options.comparison.colorMode},p=f.getSentimentFromValues(o);1===p?n=f.options.comparison.colors.good:0===p?n=f.options.comparison.colors.goodEnough:-1===p&&(n=f.options.comparison.colors.bad)}var q=8;f.tooltip.style("max-width",a(window).width()-q+"px").html(m);var r=a("div.cl-tooltip");r.find(".cl-tooltip__dimension-label").html(i.x.text),r.find(".cl-tooltip__kpi-color").css("background-color",i.colorMarker),r.find(".cl-tooltip__kpi-cell").html(i.y.text),f.options.inTargetMode?(r.find(".cl-tooltip__comparision-cell").html(l),r.find(".cl-tooltip__comparision-cell").css("color",n)):r.find(".cl-tooltip__comparision-cell").remove(),j?(r.find(".cl-tooltip__target-color").css("background-color",k.colorMarker),r.find(".cl-tooltip__target-cell").html(k.y.text)):r.find(".cl-tooltip__target-row").remove();var s=r.outerWidth(),t=r.outerHeight(),u={element:{x:c.x-b.x,y:c.y-b.y}};u.point={x:u.element.x+f.options.margins.left+d(i.x.text),y:u.element.y+f.options.margins.top+f.options.trendChartOffsetY+e(i.y.value)},"bar"===f.options.transformedData[0].type&&(u.point.x+=d.bandwidth()/2);var v=8,w=-2;if(a(".cl-tooltip").length){var x=window.getComputedStyle(document.querySelector(".cl-tooltip"),":after");v=Number(x.getPropertyValue("border-bottom-width").replace("px",""))+Number(x.getPropertyValue("border-top-width").replace("px","")),w=-v/4}var y=t+v+2,z=s/2,A=w+f.options.margins.left/2;u.point.x<s/2?(z=u.point.x,z+=-A):a(window).width()-u.point.x<s/2&&(z=s-(a(window).width()-u.point.x),z+=A),0===a("#cl-tooltip").length&&a("<style type='text/css' id='cl-tooltip' />").appendTo("head"),a("#cl-tooltip").text(".cl-tooltip:after{left:"+z+"px;}"),f.tooltip.style("left",u.point.x-z+"px").style("top",u.point.y-y+"px").style("display","inline-block")},f.$watch("$parent.layout.props.animate",function(a){f.options.animate=a}),f.$on("$destroy",function(){a("div.cl-tooltip").remove()})}],paint:function(a,c){void 0!==c.props.canTakeSnapshot&&(this.$scope.$parent.ext.snapshot.canTakeSnapshot=c.props.canTakeSnapshot);var d=this,f=function(){return 1===c.qHyperCube.qDimensionInfo.length},g=function(){return c.props.target.mode&&2===c.qHyperCube.qMeasureInfo.length},h=function(){return c.props.layout.color.mode},i=function(a){var b="#"+a.toString(16).substr(2);return b.length>4?b:!1},l=function(a){var b="#"+a.toString(16).substr(2);return b.length>4?parseInt(a.toString(16).substr(0,2),16)/255:1},m=function(a){var b=e.rgb(i(a));return b.opacity=l(a),b.toString()},n=function(a,b,c){var d=.7,e=.6;"large"===c&&(d=.65,e=.55);var f=a>b?b*d:a*e;return f+"px"},o=function(a){if(2!==a.qHyperCube.qGrandTotalRow.length)return void 0;if("byExpression"===a.props.color.target.mode)return a.props.iconDirectionExpression;var b={value01:a.qHyperCube.qGrandTotalRow[0].qNum,value02:a.qHyperCube.qGrandTotalRow[1].qNum,comparisonType:a.props.target.comparisonType,banding:a.props.target.banding,colorMode:a.props.color.target.mode};return d.$scope.getSentimentFromValues(b)},p=function(a){if("byExpression"===a.props.color.target.mode)return a.props.color.colorExpressions.target;var b=o(a);return 1===b?a.props.color.customColors.good.color:0===b?a.props.color.customColors.goodEnough.color:-1===b?a.props.color.customColors.bad.color:void 0},q=function(a){var b="cl-icon-"+a.props.target.icon.slice(0,-3),c=o(a),d={icon:-1===c?b+"-down":b+"-up"};return 0===c&&(d.icon2=b+"-down"),d},r=function(a){return g()?q(a):{icon:"cl-icon-"+a.props.icon}},s=function(a){var b={background:a.props.color.customColors.background.color,icon:a.props.color.customColors.icon.color,targetTrend:a.props.color.customColors.targetTrend.color,text:a.props.color.customColors.text.color,trend:a.props.color.customColors.trend.color};return"byExpression"===a.props.color.other.mode&&(b.background=a.props.color.colorExpressions.background,b.text=a.props.color.colorExpressions.text,b.iconAndTrend=a.props.color.colorExpressions.iconAndTrend),"byExpression"===a.props.color.icon.mode&&(b.icon=d.$scope.getColor(a.props.color.colorExpressions.icon)),"byExpression"===a.props.color.trend.mode&&(b.trend=d.$scope.getColor(a.props.color.colorExpressions.trend)),b},t=function(a){var b=s(a),c={navigation:d.$scope.getColor(a.props.color.overlay.navigationColor.color),overlay:d.$scope.getColor(a.props.color.overlay.bgcolor.color,!1,a.props.color.overlay.opacity),text:d.$scope.getColor(b.text),background:"",icon:"",targetTrend:"",targetTrendMarker:"",targetTrendLegend:"",trend:"",trendMarker:"",trendLegend:""};return g()?(b.target=p(a),h()?c.background=d.$scope.getColor(b.target):b.icon=b.target):h()&&(c.background=d.$scope.getColor(b.background)),d.$scope.color.background=h()?c.background:d.$scope.theme.backgroundColor,c.icon=d.$scope.getColor(b.icon),f()&&(a.props.color.trend.iconIndependence||(b.trend=b.icon),a.props.color.trend.autoblend?(c.trend=d.$scope.getColor(b.trend,!1,d.$scope.color.defaultBlendFactor),c.trendMarker=d.$scope.getColor(b.trend,!0,d.$scope.color.defaultBlendFactor)):(c.trend=d.$scope.getColor(b.trend,!1,a.props.color.trend.blendFactor),c.trendMarker=d.$scope.getColor(b.trend,!0,a.props.color.trend.blendFactor)),a.props.color.targetTrend.autoblend?(c.targetTrend=d.$scope.getColor(b.targetTrend,!1,d.$scope.color.defaultBlendFactor),c.targetTrendMarker=d.$scope.getColor(b.targetTrend,!0,d.$scope.color.defaultBlendFactor)):(c.targetTrend=d.$scope.getColor(b.targetTrend,!1,a.props.color.targetTrend.blendFactor),c.targetTrendMarker=d.$scope.getColor(b.targetTrend,!0,a.props.color.targetTrend.blendFactor)),c.trendLegend=b.trend,c.targetTrendLegend=b.targetTrend),c},u=function(a,b,c){var d={small:12,medium:10,large:9},e={small:6,medium:4,large:3};c=d[c]?c:"medium";var f=a/d[c],g=b/e[c],h=f>g?g:f;return h+"px"},v=function(a){var b={one:3,two:7,three:2,four:2};return"comparisonFocus"===a.textLayoutMode?b.two=5:"comparison"===a.textLayoutMode&&(b.two=5,b.three=4),b};if("relative"!==c.props.target.comparison&&c.qHyperCube.qMeasureInfo.length>0){var w=k.getNormalizedFormat(c.qHyperCube.qMeasureInfo[0].qNumFormat,c.qHyperCube.qMeasureInfo[0].qNumFormat.qFmt),x=c.qHyperCube.qMeasureInfo[0].qNumFormat.qType,y="",z="";["D","T","TS","IV"].indexOf(x)<0&&(y=c.qHyperCube.qMeasureInfo[0].qNumFormat.qThou,z=c.qHyperCube.qMeasureInfo[0].qNumFormat.qDec),d.$scope.numberFormatter=new j(d.$scope.localeInfo,w,y,z,x)}else d.$scope.initNumberFormatter();var A={id:c.qInfo.qId,animate:c.props.animate,comparisionIsRelative:"relative"===c.props.target.comparison,showTooltip:f()&&"tooltip"===c.props.hoverMode,showDetails:"details"===c.props.hoverMode,showIconWithTitle:c.props.showIconWithTitle?!0:!1,hideIcon:"noIcon"===c.props.iconSet||"icon"===c.props.backgroundImageMode,showBackgroundImage:"url"===c.props.backgroundImageMode||"contentlibrary"===c.props.backgroundImageMode,showBackgroundIcon:"icon"===c.props.backgroundImageMode&&"noIcon"!==c.props.iconSet,backgroundImageUrl:"contentlibrary"===c.props.backgroundImageMode?encodeURI(".."+c.props.backgroundContentLibraryImage):c.props.backgroundImageURL,backgroundImageSizeMode:c.props.backgroundImageSizeMode,inTargetMode:g(),targetColorModeIsExpression:"byExpression"===c.props.color.target.mode,comparison:{type:c.props.target.comparisonType,banding:c.props.target.banding,colorMode:c.props.color.target.mode,colors:{good:c.props.color.customColors.good.color,goodEnough:c.props.color.customColors.goodEnough.color,bad:c.props.color.customColors.bad.color}},hoverMode:c.props.hoverMode,hidethirdmeasure:c.props.hidethirdmeasure,sheetId:c.props.sheetId,navigation:{mode:"navigation"===c.props.hoverMode,showButton:c.props.navigation.showButton,text:c.props.navigation.text,actionBeforeNavigation:c.props.actionBeforeNavigation,field:c.props.field,value:c.props.value,values:c.props.values,variable:c.props.variable,variableValue:c.props.variableValue},labels:{},measures:{},formats:{},domains:{},trend:{},icons:r(c),color:t(c),textSize:c.props.layout.textSize,textWeight:c.props.layout.boldText?"bold":"normal",align:c.props.kpiAlign,layoutMode:c.props.layout.mode,textLayoutMode:c.props.target.layout.mode,size:{height:a.height(),width:a.width()},marginType:c.props.layout.marginType?c.props.layout.marginType:"default"};A.backgroundIconSize=n(a.width(),a.height(),A.marginType);var B={"default":{top:8,bottom:8,left:8,right:8},none:{top:0,bottom:0,left:0,right:0},large:{top:16,bottom:16,left:16,right:16}},C={"default":{left:0,right:0},none:{left:8,right:8},large:{left:0,right:0}};if(A.trendChartOffsetY=0,A.margins=b.clone(B[A.marginType]),A.padding=b.clone(C[A.marginType]),A.size.innerHeight=A.size.height-A.margins.top-A.margins.bottom,A.size.innerWidth=A.size.width-A.margins.left-A.margins.right,A.size.textWrapperHeight=A.size.innerHeight,A.size.textWrapperWidth=A.size.innerWidth-A.padding.left-A.padding.right,"top"===c.props.layout.mode&&(A.size.innerHeight=.5*A.size.innerHeight+A.margins.top,A.size.textWrapperHeight=.5*A.size.textWrapperHeight+A.margins.bottom,A.trendChartOffsetY=A.size.textWrapperHeight-A.margins.bottom-A.margins.top),A.blockSizes=v(A),f()&&(A.trend={chartType:c.qHyperCube.qDimensionInfo[0].trend.chartType,targetChartType:c.qHyperCube.qDimensionInfo[0].trend.showTargetTrend?c.qHyperCube.qDimensionInfo[0].trend.targetChartType:"",showDatapoints:c.qHyperCube.qDimensionInfo[0].trend.showDatapoints,showTargetDatapoints:c.qHyperCube.qDimensionInfo[0].trend.showTargetDatapoints}),g()){var D;"relative"===c.props.target.comparison?(A.formats.comparison="0%",1===c.props.target.precision&&(A.formats.comparison="0"+d.$scope.localeInfo.qDecimalSep+"0%"),2===c.props.target.precision&&(A.formats.comparison="0"+d.$scope.localeInfo.qDecimalSep+"00%"),D=c.qHyperCube.qGrandTotalRow[0].qNum/c.qHyperCube.qGrandTotalRow[1].qNum-1,A.measures.comparison=d.$scope.formatValue(D,A.formats.comparison)):(A.formats.comparison=c.qHyperCube.qMeasureInfo[0].qIsAutoFormat?d.$scope.DEFAULT_AUTO_FORMAT:c.qHyperCube.qMeasureInfo[0].qNumFormat.qFmt,D=c.qHyperCube.qGrandTotalRow[0].qNum-c.qHyperCube.qGrandTotalRow[1].qNum,A.measures.comparison=d.$scope.formatValue(D,A.formats.comparison))}if(c.qHyperCube.qMeasureInfo.length>0?(A.labels.kpi=""===c.props.kpiLabel?c.qHyperCube.qMeasureInfo[0].qFallbackTitle:c.props.kpiLabel,A.measures.kpi=c.qHyperCube.qMeasureInfo[0].qIsAutoFormat?d.$scope.formatValue(c.qHyperCube.qGrandTotalRow[0].qNum,d.$scope.DEFAULT_AUTO_FORMAT):c.qHyperCube.qGrandTotalRow[0].qText,A.formats.kpi=c.qHyperCube.qMeasureInfo[0].qIsAutoFormat?d.$scope.DEFAULT_AUTO_FORMAT:c.qHyperCube.qMeasureInfo[0].qNumFormat.qFmt):A.noMeasures=!0,c.qHyperCube.qMeasureInfo.length>1&&(A.labels.target=""===c.props.targetLabel?c.qHyperCube.qMeasureInfo[1].qFallbackTitle:c.props.targetLabel,A.labels.comparison=g()?c.props.target.comparisonLabel:"",A.labels.target=""!==A.labels.comparison?c.props.target.comparisonLabel:A.labels.target,A.measures.target=c.qHyperCube.qGrandTotalRow[1]?c.qHyperCube.qMeasureInfo[1].qIsAutoFormat?d.$scope.formatValue(c.qHyperCube.qGrandTotalRow[1].qNum,d.$scope.DEFAULT_AUTO_FORMAT):c.qHyperCube.qGrandTotalRow[1].qText:"",A.formats.target=c.qHyperCube.qMeasureInfo[1]&&c.qHyperCube.qMeasureInfo[1].qIsAutoFormat?d.$scope.DEFAULT_AUTO_FORMAT:c.qHyperCube.qMeasureInfo[1]?c.qHyperCube.qMeasureInfo[1].qNumFormat.qFmt:d.$scope.DEFAULT_AUTO_FORMAT),A.fontsize=u(A.size.textWrapperWidth,A.size.textWrapperHeight,A.textSize),A.fontsizeOverlay=u(A.size.textWrapperWidth,A.size.height-A.margins.top-A.margins.bottom,A.textSize),this.$scope.options=A,a.find(".trendchart").empty(),f()){A.transformedData=b.map(c.qHyperCube.qMeasureInfo,function(a,e){var f=0===e,g=f?A.color.trend:A.color.targetTrend,h=f?A.color.trendMarker:A.color.targetTrendMarker,i=a.qIsAutoFormat?d.$scope.DEFAULT_AUTO_FORMAT:void 0,j=f?A.trend.chartType:A.trend.targetChartType,k=!1,l=b.map(c.qHyperCube.qDataPages[0].qMatrix,function(b){var c={x:{text:b[0].qText},y:{text:i?d.$scope.formatValue(b[e+1].qNum,i):b[e+1].qText,value:b[e+1].qNum},id:e,color:g,colorMarker:h};return a.colorizeDatapoint&&b[e+1].qAttrExps&&"NaN"!==b[e+1].qAttrExps.qValues[0].qNum&&("bar"===j||"marker"===j)&&(c.color=m(b[e+1].qAttrExps.qValues[0].qNum),c.colorMarker=c.color),c});1===l.length&&(f?"area"===j?j="bar":"line"===j&&(j="marker"):""!==j&&(j="marker")),"marker"===j?k=!0:"line"===j&&(k=f?A.trend.showDatapoints:A.trend.showTargetDatapoints);var n={id:e,type:j,values:l,showDatapoints:k,color:g,colorMarker:h};return n}),A.domains.x=b.map(c.qHyperCube.qDataPages[0].qMatrix,function(a){return a[0].qText});var E=e.select(a.get(0)).select(".trendchart").append("svg").attr("width",A.size.width).attr("height",A.size.height),F=E.selectAll("g").data([A.transformedData]).enter().append("g").attr("transform","translate("+A.margins.left+","+(A.margins.top+A.trendChartOffsetY)+")"),G=e.scaleBand().range([0,A.size.innerWidth]).paddingInner(.2).paddingOuter(0);G.domain(A.domains.x);var H="bar"===A.trend.chartType?G.bandwidth()/2:0,I=e.scalePoint().range([0+H,A.size.innerWidth-H]);I.domain(A.domains.x);var J=e.scaleLinear().range([A.size.innerHeight,0]),K=[],L=[],M=c.qHyperCube.qDimensionInfo[0].measureAxis.min,N=c.qHyperCube.qDimensionInfo[0].measureAxis.max,O=c.qHyperCube.qDimensionInfo[0].measureAxis.minMax;if("minMax"===O&&M>N){var P=M;M=N,N=P}c.qHyperCube.qDimensionInfo[0].measureAxis.autoMinMax||"auto"===O?(L.push(c.qHyperCube.qMeasureInfo[0].qMax),K.push(c.qHyperCube.qMeasureInfo[0].qMin),""!==A.trend.targetChartType&&(L.push(c.qHyperCube.qMeasureInfo[1].qMax),K.push(c.qHyperCube.qMeasureInfo[1].qMin))):"min"===O?(K.push(M),L.push(c.qHyperCube.qMeasureInfo[0].qMax),""!==A.trend.targetChartType&&L.push(c.qHyperCube.qMeasureInfo[1].qMax)):"max"===O?(L.push(N),K.push(c.qHyperCube.qMeasureInfo[0].qMin),""!==A.trend.targetChartType&&K.push(c.qHyperCube.qMeasureInfo[1].qMin)):"minMax"===O&&(K.push(M),L.push(N)),J.domain([e.min(K),e.max(L)]),c.qHyperCube.qDimensionInfo[0].measureAxis.autoMinMax&&J.nice(),d.$scope.scales.x=I,d.$scope.scales.xBar=G,d.$scope.scales.y=J;var Q=0;J.domain()[0]>0&&J.domain()[1]>0?Q=J.domain()[0]:J.domain()[0]<0&&J.domain()[1]<0&&(Q=J.domain()[1]);var R=e.area().defined(function(a){return"NaN"!==a.y.value}).curve(e.curveLinear).x(function(a){return I(a.x.text)}).y0(J(Q)).y1(function(a){return J(a.y.value)}),S=e.line().defined(function(a){return"NaN"!==a.y.value}).curve(e.curveLinear).x(function(a){return I(a.x.text)}).y(function(a){return J(a.y.value)}),T=F.selectAll(".trendchart__series").data(function(a){return a}).enter().append("g").attr("class",function(a){return"trendchart__series trendchart__series--"+a.id});T.filter(function(a){return"line"===a.type}).append("path").attr("class","trendchart__line").attr("d",function(a){return S(a.values)}).style("stroke",function(a){return a.color}).style("stroke-opacity",function(a){return a.opacity}).style("fill","none"),T.filter(function(a){return a.showDatapoints}).selectAll("g.trendchart__circles").data(function(a){return[a]}).enter().append("g").attr("class","trendchart__circles").selectAll("marker").data(function(a){return a.values}).enter().filter(function(a){return"NaN"!==a.y.value}).append("circle").attr("class","trendchart__circle").attr("r",4).attr("cx",function(a){return I(a.x.text)}).attr("cy",function(a){return J(a.y.value)}).style("fill",function(a){return a.colorMarker}),T.filter(function(a){return"area"===a.type}).append("path").attr("class","trendchart__area").attr("d",function(a){return R(a.values)}).style("fill",function(a){return a.color}),T.filter(function(a){return"bar"===a.type}).selectAll("g.trendchart__bars").data(function(a){return[a]}).enter().append("g").attr("class","trendchart__bars").selectAll("bar").data(function(a){return a.values}).enter().filter(function(a){return"NaN"!==a.y.value}).append("rect").attr("class","trendchart__bar").attr("x",function(a){return G(a.x.text)}).attr("width",G.bandwidth()).attr("y",function(a){return J(Math.max(0,a.y.value))}).attr("height",function(a){return Math.abs(J(a.y.value)-J(0))}).style("fill",function(a){return a.color});var U=e.select("body").selectAll("div.cl-tooltip").data(["tooltip"]);U.enter().append("div").attr("class","cl-tooltip").style("opacity",0),U.exit().remove(),d.$scope.tooltip=e.select("body").select("div.cl-tooltip"),e.select(a.get(0)).select(".kpi-interaction-layer").on("mouseover",function(){d.$scope.options.showTooltip&&(d.$scope.tooltip.transition().style("opacity",.9),d.$scope.updateTooltip({x:e.mouse(this)[0],y:e.mouse(this)[1]},{x:e.event.pageX,y:e.event.pageY},"bar"===A.trend.chartType?G:I,J))}).on("mousemove",function(){d.$scope.options.showTooltip&&d.$scope.updateTooltip({x:e.mouse(this)[0],y:e.mouse(this)[1]},{x:e.event.pageX,y:e.event.pageY},"bar"===A.trend.chartType?G:I,J)}).on("mouseout",function(){d.$scope.options.showTooltip&&d.$scope.tooltip.transition().style("opacity",0)})}d.$scope.options=A}}});